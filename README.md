# Анализ портфеля акций

## Описание
Этот сервис предоставляет HTTP API, который принимает POST-запрос с данными о биржевых активах,
и вызывает с помощью RPC два разных сервиса для получения:

- классификации риска акции
- прогноза будущей доходности акции

## Основные компоненты
- **Flask API**: основной HTTP-сервер, который принимает запросы на предсказание и классификацию риска
- **RabbitMQ**: отправка запросов на два различных микросервиса через очереди RabbitMQ
- **RPC-клиент**: отправка запросов в микросервисы и получения ответа
- **Risk Classifier**: микросервис для классификации риска акции
- **Stock Predictor**: микросервис для прогноза будущей доходности акции

## Endpoint
`POST /v1/prediction`

Этот маршрут обрабатывает POST-запросы с JSON-данными.
Сервис отправляет два разных запроса через RabbitMQ:
1. в очередь для классификации риска
2. в очередь для предсказания доходности акций

### Пример запроса:
```json
{
    "stock_symbol": "AAPL",
    "volatility": 0.25,
    "average_return": 0.04,
    "market_correlation": 0.85,
    "historical_returns": [0.03, 0.04, 0.05, 0.02, 0.06],
    "volume": [120000, 110000, 130000, 140000, 125000],
    "market_index": [3000, 3050, 3100, 3020, 3080]
}
```

### Пример ответа:
```json
{
  "risk_category": "High Risk",
  "stock_prediction": "0.06694677977890295",
  "stock_symbol": "AAPL"
}
```
## Переменные окружения

Для работы с RabbitMQ:

| Переменная           |  Тип  |        Значение по умолчанию          | Комментарий                                                      |
| -------------------- | ----- | :-----------------------------------: | ---------------------------------------------------------------- |
| RMQ_URL              | `str` | `amqp://user:password@localhost:5672` | URL для доступа                                                  |
| RMQ_RISK_CLF_QUEUE   | `str` |   `invest-portfolio.risk-clf.queue`   | Название очереди для микросервиса классификации риска            |
| RMQ_STOCK_PRED_QUEUE | `str` |  `invest-portfolio.stock-pred.queue`  | Название очереди для микросервиса  предсказания доходности акций |
| RMQ_USER             | `str` |                `user`                 | Пользователь                                                     |
| RMQ_PASS             | `str` |                `pass`                 | Пароль                                                           |

## Запуск

1. Выполните сборку и запуск контейнера
   ```bash
   docker compose up --build
   ```
2. После запуска контейнера отправьте запрос
```bash
      curl -X POST http://localhost:8000/v1/prediction
      -H "Content-Type: application/json"
      -d '{
            "stock_symbol": "AAPL",
            "volatility": 0.25,
            "average_return": 0.04,
            "market_correlation": 0.85,
            "historical_returns": [0.03, 0.04, 0.05, 0.02, 0.06],
            "volume": [120000, 110000, 130000, 140000, 125000],
            "market_index": [3000, 3050, 3100, 3020, 3080]
         }'
```